<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Partyservice Kleinfeldt - Auftragsverwaltung</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 30px;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      position: relative;
    }
    .header-content {
      display: flex;
      align-items: center;
      width: 100%;
    }
    .logo {
      height: 60px;
      width: auto;
      margin-right: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(255,255,255,0.2);
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      background: linear-gradient(45deg, #ffffff, #e3f2fd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .company-info {
      margin-left: auto;
      text-align: right;
      font-size: 0.9rem;
      opacity: 0.9;
    }
    .overview {
      display: flex;
      gap: 20px;
      margin: 25px;
      flex-wrap: wrap;
    }
    .overview div {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      padding: 25px;
      flex: 1;
      text-align: center;
      font-weight: bold;
      font-size: 1.3rem;
      min-width: 200px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 2px solid rgba(255,255,255,0.1);
    }
    .overview div:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    }
    main {
      padding: 25px;
      max-width: 1400px;
      margin: 0 auto;
    }
    section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      border: 1px solid rgba(102, 126, 234, 0.1);
      transition: box-shadow 0.3s ease;
    }
    section:hover {
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    section h2 {
      color: #667eea;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
      margin-bottom: 25px;
      font-size: 1.5rem;
    }
    label {
      display: block;
      margin: 15px 0 8px;
      font-weight: 600;
      color: #333;
      font-size: 1rem;
    }
    input, select, button {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .row .column {
      flex: 1;
      min-width: 250px;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    .dynamic-block {
      background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
      border: 2px solid #e1e8ed;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 15px;
      position: relative;
      transition: all 0.3s ease;
    }
    .dynamic-block:hover {
      border-color: #667eea;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }
    .auftrag-liste {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border: 1px solid rgba(102, 126, 234, 0.1);
    }
    .auftrag-eintrag {
      border-bottom: 2px solid #f0f2ff;
      padding: 20px 0;
      position: relative;
      transition: all 0.3s ease;
    }
    .auftrag-eintrag:hover {
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border-radius: 10px;
      padding: 20px 15px;
      margin: 0 -15px;
    }
    .auftrag-eintrag:last-child {
      border-bottom: none;
    }
    .edit-mode {
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border: 3px solid #667eea;
      border-radius: 12px;
      padding: 25px;
      margin: 15px 0;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    }
    .edit-form {
      display: none;
    }
    .edit-form.active {
      display: block;
    }
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .button-group button {
      width: auto;
      padding: 10px 20px;
      font-size: 0.9em;
      min-width: 120px;
    }
    .btn-edit {
      background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%);
      box-shadow: 0 4px 15px rgba(79, 195, 247, 0.3);
    }
    .btn-edit:hover {
      box-shadow: 0 6px 20px rgba(79, 195, 247, 0.4);
    }
    .btn-save {
      background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%);
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }
    .btn-save:hover {
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }
    .btn-cancel {
      background: linear-gradient(135deg, #90a4ae 0%, #78909c 100%);
      box-shadow: 0 4px 15px rgba(144, 164, 174, 0.3);
    }
    .btn-cancel:hover {
      box-shadow: 0 6px 20px rgba(144, 164, 174, 0.4);
    }
    .btn-delete {
      background: linear-gradient(135deg, #ef5350 0%, #f44336 100%);
      box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
    }
    .btn-delete:hover {
      box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
      }
      .logo {
        margin-bottom: 10px;
        margin-right: 0;
      }
      .company-info {
        margin-left: 0;
        text-align: center;
        margin-top: 10px;
      }
      .overview {
        flex-direction: column;
        margin: 15px;
      }
      .row {
        flex-direction: column;
      }
      .button-group {
        flex-direction: column;
      }
      .button-group button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <img src="logo.png" alt="Partyservice Kleinfeldt Logo" class="logo">
      <h1>Partyservice Kleinfeldt ‚Äì Auftragsverwaltung</h1>
      <div class="company-info">
        <div>üè¢ Kr√§henstra√üe 29, 23552 L√ºbeck</div>
        <div>üìû 0451-75230</div>
      </div>
    </div>
  </header>
  <div class="overview">
    <div id="gesamtauftraege">Gespeicherte Auftr√§ge: 0</div>
    <div id="wochenauftraege">Diese Woche: 0</div>
    <div id="heuteauftraege">Heute: 0</div>
  </div>
  <main>
    <section>
      <h2>üìù Neuer Kundenauftrag</h2>
      <label for="kundenname">Kundenname</label>
<input type="text" id="kundenname">
<div class="row">
  <div class="column">
    <label for="auftragsdatum">Auftragsdatum</label>
    <input type="date" id="auftragsdatum">
  </div>
  <div class="column">
    <label for="lieferzeit">Lieferuhrzeit</label>
    <input type="time" id="lieferzeit">
  </div>
</div>
<label for="lieferort">Lieferort</label>
<input type="text" id="lieferort">
<label for="anzahlGaeste">Anzahl der G√§ste</label>
<input type="number" id="anzahlGaeste" min="1">
<h3>Vorspeisen</h3>
<div id="vorspeisenContainer"></div>
<button type="button" onclick="addVorspeise()">+ Vorspeise hinzuf√ºgen</button>
<h3>Hauptspeisen & Beilagen</h3>
<div id="hauptspeisenContainer"></div>
<button type="button" onclick="addHauptspeise()">+ Hauptspeise hinzuf√ºgen</button>
<h3>Nachspeisen</h3>
<div id="nachspeisenContainer"></div>
<button type="button" onclick="addNachspeise()">+ Nachspeise hinzuf√ºgen</button>
<button style="margin-top: 20px;" onclick="auftragSpeichern()">Auftrag speichern</button>
    </section>
    <section class="auftrag-liste">
      <h2>üìã Auftrags√ºbersicht</h2>
      <div class="row">
        <div class="column">
          <label for="filterTyp">Filter-Art:</label>
          <select id="filterTyp" onchange="updateFilterOptions()">
            <option value="alle">Alle Auftr√§ge anzeigen</option>
            <option value="datum">Nach Datum filtern</option>
            <option value="woche">Nach Kalenderwoche filtern</option>
          </select>
        </div>
        <div class="column">
          <div id="filterContainer">
            <label for="filterWert">Filter:</label>
            <input type="date" id="filterWert" onchange="zeigeAuftraege()" style="display: none;">
            <select id="filterWoche" onchange="zeigeAuftraege()" style="display: none;">
              <option value="">-- Kalenderwoche w√§hlen --</option>
            </select>
          </div>
        </div>
      </div>
      <button onclick="druckeAuswahl()">üñ®Ô∏è Auswahl drucken</button>
      <div id="auftragsListe"></div>
    </section>
  </main>
  <script>
    // In-memory storage to replace localStorage for Claude.ai compatibility
    let auftraegeDaten = [];
    
    const auftragsListe = document.getElementById('auftragsListe');

    // Hilfsfunktion: Kalenderwoche berechnen
    function getWeekNumber(date) {
      const d = new Date(date);
      d.setHours(0, 0, 0, 0);
      d.setDate(d.getDate() + 3 - (d.getDay() + 6) % 7);
      const week1 = new Date(d.getFullYear(), 0, 4);
      return 1 + Math.round(((d.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
    }

    // Hilfsfunktion: Datum von Kalenderwoche und Jahr
    function getDateFromWeek(year, week) {
      const jan4 = new Date(year, 0, 4);
      const dayOfWeek = jan4.getDay() || 7;
      const startOfWeek = new Date(jan4);
      startOfWeek.setDate(jan4.getDate() - dayOfWeek + 1 + (week - 1) * 7);
      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 6);
      return { start: startOfWeek, end: endOfWeek };
    }

    // Filter-Optionen aktualisieren
    function updateFilterOptions() {
      const filterTyp = document.getElementById('filterTyp').value;
      const filterWert = document.getElementById('filterWert');
      const filterWoche = document.getElementById('filterWoche');
      
      // Alle Filter verstecken
      filterWert.style.display = 'none';
      filterWoche.style.display = 'none';
      
      if (filterTyp === 'datum') {
        filterWert.style.display = 'block';
      } else if (filterTyp === 'woche') {
        filterWoche.style.display = 'block';
        updateWochenOptionen();
      }
      
      zeigeAuftraege();
    }

    // Kalenderwochen-Optionen basierend auf vorhandenen Auftr√§gen generieren
    function updateWochenOptionen() {
      const filterWoche = document.getElementById('filterWoche');
      const aktuelleDaten = auftraegeDaten.map(a => new Date(a.datum));
      const jahre = [...new Set(aktuelleDaten.map(d => d.getFullYear()))].sort();
      
      filterWoche.innerHTML = '<option value="">-- Kalenderwoche w√§hlen --</option>';
      
      jahre.forEach(jahr => {
        const jahresAuftraege = auftraegeDaten.filter(a => new Date(a.datum).getFullYear() === jahr);
        const wochen = [...new Set(jahresAuftraege.map(a => getWeekNumber(a.datum)))].sort((a, b) => a - b);
        
        wochen.forEach(woche => {
          const { start, end } = getDateFromWeek(jahr, woche);
          const option = document.createElement('option');
          option.value = `${jahr}-${woche}`;
          option.textContent = `KW ${woche}/${jahr} (${start.toLocaleDateString('de-DE')} - ${end.toLocaleDateString('de-DE')})`;
          filterWoche.appendChild(option);
        });
      });
    }

    // Berechnungsgrundlagen basierend auf PDF
    function berechneVorspeise(speise, anzahl, mitBrot) {
      let ergebnis = { gewicht: 0, einheit: 'g', zusatz: '' };
      
      // Alle Suppen haben 250g pro Person
      ergebnis.gewicht = anzahl * 250;
      
      // Brotberechnung f√ºr Suppen
      if (mitBrot) {
        const brote = Math.ceil((anzahl / 6) >= 0.4 ? anzahl / 6 : 0);
        ergebnis.zusatz = ` + ${brote} Brot${brote > 1 ? 'e' : ''}`;
      }
      
      return ergebnis;
    }

    function berechneHauptspeise(speise, anzahl) {
      let ergebnis = { gewicht: 0, einheit: 'g', zusatz: '' };
      
      switch(speise) {
        case 'Spanferkel mit Beilagen':
        case 'Spanferkel ohne Beilagen':
        case 'BBQ Schwein mit Beilagen':
        case 'BBQ Schwein ohne Beilagen':
          ergebnis.gewicht = anzahl * 650;
          // Automatisches Brot bei "mit Beilagen"
          if (speise.includes('mit Beilagen')) {
            const brote = Math.ceil(anzahl / 10);
            ergebnis.zusatz = ` + ${brote} Brot${brote > 1 ? 'e' : ''}`;
          }
          break;
        case 'Pulled Pork':
          ergebnis.gewicht = anzahl * 300;
          const brotePulled = Math.ceil(anzahl / 10);
          ergebnis.zusatz = ` + ${brotePulled} Brot${brotePulled > 1 ? 'e' : ''}`;
          break;
        case 'Amerikanische Knabbereien':
          const rippen = Math.ceil((anzahl / 5) * 3);
          const wings = anzahl * 4;
          const finger = anzahl * 4;
          const broteAmerikan = Math.ceil(anzahl / 10);
          ergebnis.gewicht = 0; // Komplexe Berechnung
          ergebnis.einheit = '';
          ergebnis.zusatz = `${rippen} Rippen, ${wings} Wings, ${finger} Finger + ${broteAmerikan} Brot${broteAmerikan > 1 ? 'e' : ''}`;
          return ergebnis;
        default:
          // Standardgerichte: 250g pro Person
          ergebnis.gewicht = anzahl * 250;
      }
      
      return ergebnis;
    }

    function berechneBeilage(speise, anzahl) {
      let ergebnis = { gewicht: 0, einheit: 'g', zusatz: '' };
      
      // Spezielle Salat-Berechnung wird separat behandelt
      const salatSorten = ['Kartoffelsalat', 'Speckkartoffelsalat', 'Nudelsalat', 'Krautsalat Natur', 'Krautsalat in Yogurtso√üe'];
      const nurPersonenSalate = ['frischer gemischter Salat', 'Griechischer Salat', 'Eisberg Melonen Salat'];
      
      if (nurPersonenSalate.includes(speise)) {
        ergebnis.gewicht = 0;
        ergebnis.einheit = 'Pers.';
        ergebnis.zusatz = '';
        return ergebnis;
      }
      
      switch(speise) {
        case 'Reis':
          const tueten = Math.ceil(anzahl / 10);
          ergebnis.gewicht = tueten;
          ergebnis.einheit = tueten > 1 ? 'T√ºten' : 'T√ºte';
          ergebnis.zusatz = '';
          break;
        case 'geschmortes Kraut':
          ergebnis.gewicht = anzahl * 150;
          break;
        default:
          if (salatSorten.includes(speise)) {
            // Standardberechnung f√ºr Salate (wird bei Spanferkel/BBQ speziell behandelt)
            ergebnis.gewicht = anzahl * 250; // Fallback
          } else {
            // Kartoffelbeilagen und Standardgem√ºse: 250g pro Person
            ergebnis.gewicht = anzahl * 250;
          }
      }
      
      return ergebnis;
    }

    function berechneNachspeise(speise, anzahl) {
      // Nachspeisen behalten die urspr√ºnglichen Portionsgr√∂√üen
      const portionsgroessen = {
        'Mousse au Chocolat': 120,
        'Rote Gr√ºtze mit Vanilleso√üe': 150,
        'Tiramisu': 120,
        'Obstsalat': 150,
        'Mascarponequark mit Himbeermark': 120,
        'Vanillemousse': 120
      };
      
      const gewicht = (portionsgroessen[speise] || 120) * anzahl;
      return { gewicht, einheit: 'g', zusatz: '' };
    }

    function sammeleSpeisen() {
      const vorspeisen = [];
      const hauptspeisen = [];
      const beilagen = [];
      const nachspeisen = [];
      
      // Vorspeisen sammeln
      document.querySelectorAll('#vorspeisenContainer .dynamic-block').forEach(block => {
        const speiseSelect = block.querySelector('select');
        const anzahlInput = block.querySelector('input[type="number"]');
        const brotCheckbox = block.querySelector('input[type="checkbox"]');
        
        if (speiseSelect && anzahlInput) {
          const speise = speiseSelect.value;
          const anzahl = parseInt(anzahlInput.value) || 0;
          const brot = brotCheckbox ? brotCheckbox.checked : false;
          
          if (speise !== '-- Bitte w√§hlen --' && anzahl > 0) {
            vorspeisen.push({ speise, anzahl, brot });
          }
        }
      });
      
      // Hauptspeisen sammeln
      document.querySelectorAll('#hauptspeisenContainer .dynamic-block').forEach(block => {
        const speiseSelect = block.querySelector('select');
        const anzahlInput = block.querySelector('input[type="number"]');
        
        if (speiseSelect && anzahlInput) {
          const speise = speiseSelect.value;
          const anzahl = parseInt(anzahlInput.value) || 0;
          
          if (speise !== '-- Bitte w√§hlen --' && anzahl > 0) {
            hauptspeisen.push({ speise, anzahl });
          }
        }
        
        // Beilagen dieser Hauptspeise sammeln
        block.querySelectorAll('.beilagen-container .dynamic-block').forEach(beilageBlock => {
          const beilageSelect = beilageBlock.querySelector('select');
          const beilageAnzahlInput = beilageBlock.querySelector('input[type="number"]');
          
          if (beilageSelect && beilageAnzahlInput) {
            const beilage = beilageSelect.value;
            const beilageAnzahl = parseInt(beilageAnzahlInput.value) || 0;
            
            if (beilage && beilageAnzahl > 0) {
              beilagen.push({ speise: beilage, anzahl: beilageAnzahl });
            }
          }
        });
      });
      
      // Nachspeisen sammeln
      document.querySelectorAll('#nachspeisenContainer .dynamic-block').forEach(block => {
        const speiseSelect = block.querySelector('select');
        const anzahlInput = block.querySelector('input[type="number"]');
        
        if (speiseSelect && anzahlInput) {
          const speise = speiseSelect.value;
          const anzahl = parseInt(anzahlInput.value) || 0;
          
          if (speise !== '-- Bitte w√§hlen --' && anzahl > 0) {
            nachspeisen.push({ speise, anzahl });
          }
        }
      });
      
      return { vorspeisen, hauptspeisen, beilagen, nachspeisen };
    }

    function fasseBeilagenZusammen(beilagen) {
      const zusammengefasst = {};
      beilagen.forEach(beilage => {
        if (zusammengefasst[beilage.speise]) {
          zusammengefasst[beilage.speise] += beilage.anzahl;
        } else {
          zusammengefasst[beilage.speise] = beilage.anzahl;
        }
      });
      return Object.entries(zusammengefasst).map(([speise, anzahl]) => ({ speise, anzahl }));
    }

    function auftragSpeichern() {
      const name = document.getElementById('kundenname').value;
      const datum = document.getElementById('auftragsdatum').value;
      const zeit = document.getElementById('lieferzeit').value;
      const ort = document.getElementById('lieferort').value;
      const gaeste = document.getElementById('anzahlGaeste').value;
      
      if (!name || !datum || !zeit || !ort || !gaeste) {
        alert("Bitte alle Pflichtfelder ausf√ºllen.");
        return;
      }
      
      const speisen = sammeleSpeisen();
      const beilagenZusammengefasst = fasseBeilagenZusammen(speisen.beilagen);
      
      const neuerAuftrag = { 
        name, 
        datum, 
        zeit, 
        ort, 
        gaeste: parseInt(gaeste),
        vorspeisen: speisen.vorspeisen,
        hauptspeisen: speisen.hauptspeisen,
        beilagen: beilagenZusammengefasst,
        nachspeisen: speisen.nachspeisen,
        id: Date.now() 
      };
      
      auftraegeDaten.push(neuerAuftrag);
      zeigeAuftraege();
      updateStatistiken();
      
      // Clear form
      document.getElementById('kundenname').value = '';
      document.getElementById('auftragsdatum').value = '';
      document.getElementById('lieferzeit').value = '';
      document.getElementById('lieferort').value = '';
      document.getElementById('anzahlGaeste').value = '';
      document.getElementById('vorspeisenContainer').innerHTML = '';
      document.getElementById('hauptspeisenContainer').innerHTML = '';
      document.getElementById('nachspeisenContainer').innerHTML = '';
    }

    function updateStatistiken() {
      const heute = new Date().toISOString().split('T')[0];
      const aktuelleWoche = getWeekNumber(heute);
      const aktuellesJahr = new Date().getFullYear();
      
      const heuteAuftraege = auftraegeDaten.filter(a => a.datum === heute).length;
      const wochenAuftraege = auftraegeDaten.filter(a => {
        const auftragsDatum = new Date(a.datum);
        return getWeekNumber(a.datum) === aktuelleWoche && auftragsDatum.getFullYear() === aktuellesJahr;
      }).length;
      
      document.getElementById('gesamtauftraege').innerText = `Gespeicherte Auftr√§ge: ${auftraegeDaten.length}`;
      document.getElementById('wochenauftraege').innerText = `Diese Woche: ${wochenAuftraege}`;
      document.getElementById('heuteauftraege').innerText = `Heute: ${heuteAuftraege}`;
    }

    function formatiereSpeisen(auftrag) {
      let speisenHtml = '<div style="margin-top: 10px; font-size: 0.9em;">';
      
      // Vorspeisen
      if (auftrag.vorspeisen && auftrag.vorspeisen.length > 0) {
        speisenHtml += '<strong>Vorspeisen:</strong><br>';
        auftrag.vorspeisen.forEach(vorspeise => {
          const berechnung = berechneVorspeise(vorspeise.speise, vorspeise.anzahl, vorspeise.brot);
          const gewichtText = berechnung.gewicht >= 1000 ? `${(berechnung.gewicht/1000).toFixed(1)} kg` : `${berechnung.gewicht} ${berechnung.einheit}`;
          speisenHtml += `‚Ä¢ ${vorspeise.speise} (${vorspeise.anzahl} Pers., ${gewichtText})${berechnung.zusatz}<br>`;
        });
        speisenHtml += '<br>';
      }
      
      // Hauptspeisen
      if (auftrag.hauptspeisen && auftrag.hauptspeisen.length > 0) {
        speisenHtml += '<strong>Hauptspeisen:</strong><br>';
        auftrag.hauptspeisen.forEach(hauptspeise => {
          const berechnung = berechneHauptspeise(hauptspeise.speise, hauptspeise.anzahl);
          let gewichtText = '';
          if (berechnung.gewicht > 0) {
            gewichtText = berechnung.gewicht >= 1000 ? `${(berechnung.gewicht/1000).toFixed(1)} kg` : `${berechnung.gewicht} ${berechnung.einheit}`;
            speisenHtml += `‚Ä¢ ${hauptspeise.speise} (${hauptspeise.anzahl} Pers., ${gewichtText})${berechnung.zusatz}<br>`;
          } else {
            speisenHtml += `‚Ä¢ ${hauptspeise.speise} (${hauptspeise.anzahl} Pers.)${berechnung.zusatz}<br>`;
          }
        });
        speisenHtml += '<br>';
      }
      
      // Beilagen (zusammengefasst)
      if (auftrag.beilagen && auftrag.beilagen.length > 0) {
        speisenHtml += '<strong>Beilagen:</strong><br>';
        auftrag.beilagen.forEach(beilage => {
          const berechnung = berechneBeilage(beilage.speise, beilage.anzahl);
          if (berechnung.einheit === 'Pers.') {
            speisenHtml += `‚Ä¢ ${beilage.speise} (${beilage.anzahl} Pers.)<br>`;
          } else if (berechnung.einheit === 'T√ºte' || berechnung.einheit === 'T√ºten') {
            speisenHtml += `‚Ä¢ ${beilage.speise} (${beilage.anzahl} Pers., ${berechnung.gewicht} ${berechnung.einheit})<br>`;
          } else {
            const gewichtText = berechnung.gewicht >= 1000 ? `${(berechnung.gewicht/1000).toFixed(1)} kg` : `${berechnung.gewicht} g`;
            speisenHtml += `‚Ä¢ ${beilage.speise} (${beilage.anzahl} Pers., ${gewichtText})<br>`;
          }
        });
        speisenHtml += '<br>';
      }
      
      // Nachspeisen
      if (auftrag.nachspeisen && auftrag.nachspeisen.length > 0) {
        speisenHtml += '<strong>Nachspeisen:</strong><br>';
        auftrag.nachspeisen.forEach(nachspeise => {
          const berechnung = berechneNachspeise(nachspeise.speise, nachspeise.anzahl);
          const gewichtText = berechnung.gewicht >= 1000 ? `${(berechnung.gewicht/1000).toFixed(1)} kg` : `${berechnung.gewicht} g`;
          speisenHtml += `‚Ä¢ ${nachspeise.speise} (${nachspeise.anzahl} Pers., ${gewichtText})<br>`;
        });
      }
      
      speisenHtml += '</div>';
      return speisenHtml;
    }

    function zeigeAuftraege() {
      const filterTyp = document.getElementById("filterTyp").value;
      let gefiltert = auftraegeDaten;
      
      if (filterTyp === 'datum') {
        const filterDatum = document.getElementById("filterWert").value;
        if (filterDatum) {
          gefiltert = auftraegeDaten.filter(a => a.datum === filterDatum);
        }
      } else if (filterTyp === 'woche') {
        const filterWoche = document.getElementById("filterWoche").value;
        if (filterWoche) {
          const [jahr, woche] = filterWoche.split('-').map(Number);
          const { start, end } = getDateFromWeek(jahr, woche);
          
          gefiltert = auftraegeDaten.filter(a => {
            const auftragsDatum = new Date(a.datum);
            return auftragsDatum >= start && auftragsDatum <= end;
          });
        }
      }
      
      gefiltert.sort((a, b) => new Date(a.datum + 'T' + a.zeit) - new Date(b.datum + 'T' + b.zeit));
      auftragsListe.innerHTML = "";
      
      gefiltert.forEach((auftrag) => {
        const auftragsDatum = new Date(auftrag.datum);
        const kw = getWeekNumber(auftrag.datum);
        const div = document.createElement("div");
        div.className = "auftrag-eintrag";
        div.setAttribute('data-auftrag-id', auftrag.id);
        
        div.innerHTML = `
          <div class="normal-view">
            <input type="checkbox" class="druckauswahl" data-id="${auftrag.id}"> 
            <strong>${auftrag.name}</strong> ‚Äì ${auftrag.datum} um ${auftrag.zeit} <small>(KW ${kw})</small><br>
            ${auftrag.ort} ‚Äì ${auftrag.gaeste} G√§ste
            ${formatiereSpeisen(auftrag)}
            <div class="button-group">
              <button class="btn-edit" onclick="starteBearbeitung(${auftrag.id})">‚úèÔ∏è Bearbeiten</button>
              <button class="btn-delete" onclick="auftragLoeschen(${auftrag.id})">üóëÔ∏è L√∂schen</button>
            </div>
          </div>
          
          <div class="edit-form">
            <h4>Auftrag bearbeiten</h4>
            <label>Kundenname:</label>
            <input type="text" class="edit-name" value="${auftrag.name}">
            
            <div class="row">
              <div class="column">
                <label>Auftragsdatum:</label>
                <input type="date" class="edit-datum" value="${auftrag.datum}">
              </div>
              <div class="column">
                <label>Lieferuhrzeit:</label>
                <input type="time" class="edit-zeit" value="${auftrag.zeit}">
              </div>
            </div>
            
            <label>Lieferort:</label>
            <input type="text" class="edit-ort" value="${auftrag.ort}">
            
            <label>Anzahl der G√§ste:</label>
            <input type="number" class="edit-gaeste" value="${auftrag.gaeste}" min="1">
            
            <div class="speisen-edit-container" style="margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa;">
              <!-- Hier werden die Speisen dynamisch eingef√ºgt -->
            </div>
            
            <div class="button-group">
              <button class="btn-save" onclick="speichereBearbeitung(${auftrag.id})">üíæ Speichern</button>
              <button class="btn-cancel" onclick="brecheBearbeitungAb(${auftrag.id})">‚ùå Abbrechen</button>
            </div>
          </div>
        `;
        auftragsListe.appendChild(div);
      });
      
      updateStatistiken();
      
      // Wochenoptionen aktualisieren falls n√∂tig
      if (filterTyp === 'woche') {
        updateWochenOptionen();
      }
    }

    function starteBearbeitung(id) {
      const auftragDiv = document.querySelector(`[data-auftrag-id="${id}"]`);
      const normalView = auftragDiv.querySelector('.normal-view');
      const editForm = auftragDiv.querySelector('.edit-form');
      
      normalView.style.display = 'none';
      editForm.style.display = 'block';
      editForm.classList.add('active');
      auftragDiv.classList.add('edit-mode');
    }

    function brecheBearbeitungAb(id) {
      const auftragDiv = document.querySelector(`[data-auftrag-id="${id}"]`);
      const normalView = auftragDiv.querySelector('.normal-view');
      const editForm = auftragDiv.querySelector('.edit-form');
      
      normalView.style.display = 'block';
      editForm.style.display = 'none';
      editForm.classList.remove('active');
      auftragDiv.classList.remove('edit-mode');
    }

    function speichereBearbeitung(id) {
      const auftragDiv = document.querySelector(`[data-auftrag-id="${id}"]`);
      const name = auftragDiv.querySelector('.edit-name').value;
      const datum = auftragDiv.querySelector('.edit-datum').value;
      const zeit = auftragDiv.querySelector('.edit-zeit').value;
      const ort = auftragDiv.querySelector('.edit-ort').value;
      const gaeste = auftragDiv.querySelector('.edit-gaeste').value;
      
      if (!name || !datum || !zeit || !ort || !gaeste) {
        alert("Bitte alle Pflichtfelder ausf√ºllen.");
        return;
      }
      
      const auftragIndex = auftraegeDaten.findIndex(a => a.id === id);
      if (auftragIndex !== -1) {
        auftraegeDaten[auftragIndex] = {
          ...auftraegeDaten[auftragIndex],
          name,
          datum,
          zeit,
          ort,
          gaeste: parseInt(gaeste)
        };
        
        zeigeAuftraege();
      }
    }

    function auftragLoeschen(id) {
      if (confirm('Sind Sie sicher, dass Sie diesen Auftrag l√∂schen m√∂chten?')) {
        auftraegeDaten = auftraegeDaten.filter(a => a.id !== id);
        zeigeAuftraege();
      }
    }

    function druckeAuswahl() {
      const checked = Array.from(document.querySelectorAll(".druckauswahl:checked"));
      if (checked.length === 0) {
        alert("Bitte mindestens einen Auftrag zur Ausgabe ausw√§hlen.");
        return;
      }
      const ids = checked.map(cb => Number(cb.dataset.id));
      const auszudrucken = auftraegeDaten.filter(a => ids.includes(a.id));
      let html = '<h1>Ausgew√§hlte Kundenauftr√§ge</h1>';
      auszudrucken.forEach(a => {
        html += `<div style='margin-bottom:30px; border-bottom: 1px solid #ccc; padding-bottom: 20px;'>
          <h3>${a.name}</h3>
          <p><strong>Datum:</strong> ${a.datum} ‚Äì ${a.zeit}<br>
          <strong>Ort:</strong> ${a.ort}<br>
          <strong>G√§ste:</strong> ${a.gaeste}</p>
          ${formatiereSpeisen(a)}
        </div>`;
      });
      const win = window.open('', '_blank');
      win.document.write(`<html><head><title>Druckansicht</title><style>body{font-family:Arial,sans-serif;margin:20px;}</style></head><body>${html}</body></html>`);
      win.document.close();
      win.print();
    }

    function addVorspeise() {
      const container = document.getElementById('vorspeisenContainer');
      const block = document.createElement('div');
      block.className = 'dynamic-block';
      block.innerHTML = `
        <label>Vorspeise</label>
        <select>
          <option>-- Bitte w√§hlen --</option>
          <option>Kartoffelsuppe mit W√ºrstchen</option>
          <option>Kartoffelsuppe Vegetarisch</option>
          <option>Lauch Hack Suppe</option>
          <option>Gulaschsuppe</option>
          <option>Broccolicremesuppe</option>
          <option>Chilli Con Carne</option>
          <option>Chilli Sin Carne</option>
        </select>
        <label>Personenzahl</label>
        <input type="number" min="1">
        <label><input type="checkbox"> Brot dazu?</label>
        <button type="button" onclick="this.parentElement.remove()">L√∂schen</button>
      `;
      container.appendChild(block);
    }

    function addHauptspeise() {
      const container = document.getElementById('hauptspeisenContainer');
      const block = document.createElement('div');
      block.className = 'dynamic-block';
      const beilagenId = 'beilagen_' + Date.now();
      block.innerHTML = `
        <label>Hauptspeise</label>
        <select>
          <option>-- Bitte w√§hlen --</option>
          <option>Spanferkel mit Beilagen</option>
          <option>BBQ Schwein mit Beilagen</option>
          <option>Spanferkel ohne Beilagen</option>
          <option>BBQ Schwein ohne Beilagen</option>
          <option>Honigschinken</option>
          <option>Grillschinken</option>
          <option>Glasierte Pute</option>
          <option>Rinderbraten</option>
          <option>Kr√§uterbraten</option>
          <option>Gyrosbraten</option>
          <option>Griechischer Rahmbraten</option>
          <option>Spie√übraten</option>
          <option>Altdeutscher Bierbraten</option>
          <option>Schweinefilet in Sahnesauce</option>
          <option>Kassler im Bl√§tterteig</option>
          <option>Bayrischer Leberk√§se</option>
          <option>Gr√ºnkohl</option>
          <option>Wildschweinbraten</option>
          <option>Amerikanische Knabbereien</option>
          <option>Pulled Pork</option>
        </select>
        <label>Personenzahl</label>
        <input type="number" min="1">
        <div id="${beilagenId}" class="beilagen-container"></div>
        <button type="button" onclick="addBeilage('${beilagenId}')">+ Beilage hinzuf√ºgen</button>
        <button type="button" onclick="this.parentElement.remove()">Hauptspeise l√∂schen</button>
      `;
      container.appendChild(block);
    }

    function addBeilage(containerId) {
      const container = document.getElementById(containerId);
      const block = document.createElement('div');
      block.className = 'dynamic-block';
      block.innerHTML = `
        <label>Beilage</label>
        <select>
          <option disabled>-- Kartoffelbeilagen --</option>
          <option>Kartoffelgratin</option>
          <option>R√∂stkartoffeln</option>
          <option>Kartoffelspalten</option>
          <option>Salzkartoffeln</option>
          <option>Bratkartoffeln</option>
          <option>Kartoffelkl√∂√üe</option>
          <option>Reis</option>
          <option disabled>-- Gem√ºse --</option>
          <option>bunte Gem√ºseauswahl</option>
          <option>geschmortes Kraut</option>
          <option>Erbsen & M√∂hren</option>
          <option>Rosenkohl</option>
          <option>Brokkoli</option>
          <option>Blumenkohl</option>
          <option disabled>-- Salate --</option>
          <option>Kartoffelsalat</option>
          <option>Speckkartoffelsalat</option>
          <option>Nudelsalat</option>
          <option>frischer gemischter Salat</option>
          <option>Eisberg Melonen Salat</option>
          <option>Griechischer Salat</option>
          <option>Krautsalat Natur</option>
          <option>Krautsalat in Yogurtso√üe</option>
        </select>
        <label>Personenzahl</label>
        <input type="number" min="1">
        <button type="button" onclick="this.parentElement.remove()">Beilage l√∂schen</button>
      `;
      container.appendChild(block);
    }

    function addNachspeise() {
      const container = document.getElementById('nachspeisenContainer');
      const block = document.createElement('div');
      block.className = 'dynamic-block';
      block.innerHTML = `
        <label>Nachspeise</label>
        <select>
          <option>-- Bitte w√§hlen --</option>
          <option>Mousse au Chocolat</option>
          <option>Rote Gr√ºtze mit Vanilleso√üe</option>
          <option>Tiramisu</option>
          <option>Obstsalat</option>
          <option>Mascarponequark mit Himbeermark</option>
          <option>Vanillemousse</option>
        </select>
        <label>Personenzahl</label>
        <input type="number" min="1">
        <button type="button" onclick="this.parentElement.remove()">L√∂schen</button>
      `;
      container.appendChild(block);
    }

    // Initialisierung beim Laden der Seite
    window.onload = function() {
      zeigeAuftraege();
      updateStatistiken();
    };
  </script>
</body>
</html>