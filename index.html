
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Partyservice Kleinfeldt – V20</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; font-size: 12px; background: #f9f9f9; padding: 10px; max-width: 1000px; margin: auto; }
    header { display: flex; align-items: center; margin-bottom: 10px; }
    header img { height: 40px; margin-right: 10px; }
    h1 { font-size: 18px; margin: 0; }
    label, input, select, textarea { font-size: 12px; margin: 2px 0; }
    .auftrag { background: white; padding: 10px; margin: 10px 0; border-radius: 6px; box-shadow: 0 0 4px rgba(0,0,0,0.1); page-break-inside: avoid; }
    .highlight { background: #e0f7da; display: inline-block; padding: 2px 4px; margin: 1px; border-radius: 4px; font-size: 11px; }
    .loeschen-btn { float: right; background: #c00; color: white; border: none; padding: 2px 6px; font-size: 10px; cursor: pointer; }
    .gericht-block, .beilage-block { border: 1px solid #ccc; padding: 6px; margin-top: 5px; border-radius: 4px; background: #fff; }
    button { margin-top: 5px; }
    @media print {
      button, .loeschen-btn { display: none !important; }
    }
  </style>
</head>
<body>
<header>
  <img src="logo.png" alt="Logo">
  <h1>Partyservice Kleinfeldt – Auftragsübersicht</h1>
</header>

<form id="auftragForm">
  <label>Kunde: <input type="text" id="kunde" required></label><br>
  <label>Lieferdatum: <input type="date" id="datum" required></label><br>
  <label>Gesamtpersonen: <input type="number" id="personen" required></label><br>
  <div id="gerichteContainer"></div>
  <button type="button" onclick="addGericht()">+ Speise / Beilage hinzufügen</button><br>
  <label>Lieferort: <input type="text" id="ort"></label><br>
  <label>Lieferzeit: <input type="time" id="zeit"></label><br>
  <label>Telefon: <input type="tel" id="telefon"></label><br>
  <label>Notizen:<br><textarea id="notizen" rows="2" cols="40"></textarea></label><br>
  <button type="submit">Auftrag speichern</button>
</form>

<button onclick="window.print()">Alle Aufträge drucken</button>
<div id="auftragListe"></div>

<script>
const farben = ["#ffcccc", "#ccffcc", "#ccccff", "#ffffcc", "#ffccff", "#ccffff"];
const beilageFarben = new Map();
let farbIndex = 0;

function getBeilageFarbe(name) {
  const key = name.toLowerCase();
  if (!beilageFarben.has(key)) {
    beilageFarben.set(key, farben[farbIndex % farben.length]);
    farbIndex++;
  }
  return beilageFarben.get(key);
}

function formatDatumMitWochentag(d) {
  const dt = new Date(d);
  const wochentage = ["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];
  return wochentage[dt.getDay()] + ", " +
         ('0'+dt.getDate()).slice(-2) + '.' +
         ('0'+(dt.getMonth()+1)).slice(-2) + '.' + dt.getFullYear();
}

function addGericht() {
  const container = document.getElementById("gerichteContainer");
  const block = document.createElement("div");
  block.className = "gericht-block";

  const speisen = [
    "Spanferkel", "BBQ Spanferkel", "Honigschinken", "Grillschinken", "Glasierte Pute", "Rinderbraten",
    "Kräuterbraten", "Gyrosbraten", "Griechischer Rahmbraten", "Spießbraten", "Altdeutscher Bierbraten",
    "Schweinefilet in Sahnesauce", "Kassler im Blätterteig", "Bayrischer Leberkäse", "Grünkohl",
    "Wildschweinbraten", "Amerikanische Knabbereien", "Pulled Pork"
  ];

  const options = speisen.map(s => `<option>${s}</option>`).join("");
  block.innerHTML = `
    <label>Speise: <select>${options}</select></label>
    <label>Personen: <input type="number" value="1"></label><br>
    <div class="beilagen"></div>
    <button type="button" onclick="addBeilage(this)">+ Beilage</button>
    <button type="button" class="loeschen-btn" onclick="this.parentElement.remove()">X</button>
  `;
  container.appendChild(block);
}

function addBeilage(btn) {
  const div = document.createElement("div");
  div.className = "beilage-block";
  const kartoffeln = ["Kartoffelgratin", "Röstkartoffeln", "Kartoffelspalten", "Kartoffelpüree", "Bratkartoffeln", "Salzkartoffeln", "Reis"];
  const gemuese = ["Bunte Gemüseauswahl", "Rotkohl", "Rosenkohl", "Geschmortes Kraut"];
  const salate = ["Weißkrautsalat Natur", "Weißkrautsalat mit Yogurt", "Frischer gemischter Salat", "Eisberg-Melonen Salat",
                  "Griechischer Salat", "Kartoffelsalat", "Speckkartoffelsalat", "Nudelsalat", "Coleslaw"];
  let html = '<label>Beilage: <select>';
  html += '<optgroup label="Kartoffeln">' + kartoffeln.map(b => `<option>${b}</option>`).join("") + '</optgroup>';
  html += '<optgroup label="Gemüse">' + gemuese.map(b => `<option>${b}</option>`).join("") + '</optgroup>';
  html += '<optgroup label="Salate">' + salate.map(b => `<option>${b}</option>`).join("") + '</optgroup>';
  html += '</select></label> ';
  html += '<label>Personen: <input type="number" value="1"></label>';
  html += '<button type="button" class="loeschen-btn" onclick="this.parentElement.remove()">X</button>';
  div.innerHTML = html;
  btn.parentElement.querySelector(".beilagen").appendChild(div);
}

document.getElementById("auftragForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const kunde = document.getElementById("kunde").value;
  const datum = document.getElementById("datum").value;
  const personen = parseInt(document.getElementById("personen").value);
  const ort = document.getElementById("ort").value;
  const zeit = document.getElementById("zeit").value;
  const telefon = document.getElementById("telefon").value;
  const notizen = document.getElementById("notizen").value;

  let speisenOutput = "";
  let beilagenMap = new Map();
  let speisenMap = new Map();

  document.querySelectorAll(".gericht-block").forEach(g => {
    const name = g.querySelector("select").value;
    const p = parseInt(g.querySelector("input").value);
    if (!speisenMap.has(name)) speisenMap.set(name, 0);
    speisenMap.set(name, speisenMap.get(name) + p);

    speisenOutput += `<p><strong>${name}</strong> für ${p} Personen</p>`;
    const beilagen = g.querySelectorAll(".beilage-block");
    beilagen.forEach(b => {
      const bname = b.querySelector("select").value;
      const bp = parseInt(b.querySelector("input").value);
      const key = bname.toLowerCase();
      if (!beilagenMap.has(key)) beilagenMap.set(key, 0);
      beilagenMap.set(key, beilagenMap.get(key) + bp);
    });
  });

  let mengen = "";
  speisenMap.forEach((anzahl, name) => {
    const gramm = name.toLowerCase().includes("spanferkel") ? 650 : 250;
    mengen += `<span class="highlight">${name}: ${(anzahl * gramm / 1000).toFixed(2)} kg Fleisch</span> `;
  });

  beilagenMap.forEach((anzahl, name) => {
    const gramm = name.includes("geschmortes kraut") ? 150 : 250;
    mengen += `<span class="highlight" style="background-color:${getBeilageFarbe(name)}">${name}: ${(anzahl * gramm / 1000).toFixed(2)} kg</span> `;
  });

  const output = document.createElement("div");
  output.className = "auftrag";
  output.innerHTML = `
    <button class="loeschen-btn" onclick="this.parentElement.remove()">X</button>
    <h3>${kunde}</h3>
    <p><strong>Lieferdatum:</strong> ${formatDatumMitWochentag(datum)}<br>
    <strong>Ort:</strong> ${ort}, <strong>Zeit:</strong> ${zeit}, <strong>Tel:</strong> ${telefon}</p>
    <p><strong>Notizen:</strong> ${notizen}</p>
    ${speisenOutput}
    <p><strong>Mengenübersicht:</strong><br>${mengen}</p>
  `;
  document.getElementById("auftragListe").appendChild(output);
  this.reset();
  document.getElementById("gerichteContainer").innerHTML = "";
});
</script>
</body>
</html>
