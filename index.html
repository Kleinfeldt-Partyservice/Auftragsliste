<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partyservice Kleinfeldt - Auftragserfassung</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .form-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .auftraege-liste {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, button, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        .row {
            display: flex;
            gap: 20px;
        }
        
        .col {
            flex: 1;
        }
        
        .time-picker {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .time-picker select {
            width: 80px;
        }
        
        .speise-block {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
            border: 2px solid #e1e8ed;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .speise-block:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .speise-block button {
            width: auto;
            padding: 5px 15px;
            margin-top: 10px;
            background: #dc3545;
        }
        
        .beilagen-container {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .auftrag {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .auftrag:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .auftraege-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .auftraege-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .data-management {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .data-management h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .data-management button {
            width: auto;
            padding: 8px 15px;
            margin-right: 10px;
        }
        
        .data-management .export-btn {
            background: #28a745;
        }
        
        .data-management .import-btn {
            background: #007bff;
        }
        
        .data-management .delete-btn {
            background: #dc3545;
        }
        
        .data-management p {
            margin: 10px 0 0 0;
            font-size: 0.9em;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Partyservice Kleinfeldt ‚Äì Auftragserfassung</h1>
            <p>Kr√§henstra√üe 29, 23552 L√ºbeck | üìû 0451-75230</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h3 id="total">Gesamt: 0</h3>
            </div>
            <div class="stat-card">
                <h3 id="week">Diese Woche: 0</h3>
            </div>
            <div class="stat-card">
                <h3 id="today">Heute: 0</h3>
            </div>
        </div>
        
        <div class="form-section">
            <h2>üìù Neuer Auftrag</h2>
            
            <div class="form-group">
                <label for="kunde">Kundenname:</label>
                <input type="text" id="kunde" placeholder="Name des Kunden">
            </div>
            
            <div class="form-group">
                <label for="telefon">Telefonnummer:</label>
                <input type="tel" id="telefon" placeholder="Telefonnummer des Kunden">
            </div>
            
            <div class="form-group">
                <label for="notizen">Notizen:</label>
                <textarea id="notizen" placeholder="Individuelle Notizen zum Auftrag" rows="3" style="resize: vertical; font-family: Arial, sans-serif;"></textarea>
            </div>
            
            <div class="row">
                <div class="col">
                    <label for="datum">Datum:</label>
                    <input type="date" id="datum">
                </div>
                <div class="col">
                    <label>Uhrzeit:</label>
                    <div class="time-picker">
                        <select id="stunden">
                            <option value="">Std</option>
                            <option value="08">08</option>
                            <option value="09">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                        </select>
                        <span>:</span>
                        <select id="minuten">
                            <option value="">Min</option>
                            <option value="00">00</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                            <option value="45">45</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="ort">Lieferort:</label>
                <input type="text" id="ort" placeholder="Adresse f√ºr die Lieferung">
            </div>
            
            <div class="form-group">
                <label for="gaeste">Anzahl G√§ste:</label>
                <input type="number" id="gaeste" min="1" placeholder="Anzahl der G√§ste">
            </div>
            
            <h3>üç≤ Vorspeisen</h3>
            <div id="vorspeisen-container"></div>
            <button type="button" onclick="addVorspeise()">+ Vorspeise hinzuf√ºgen</button>
            
            <h3>üçñ Hauptspeisen & Beilagen</h3>
            <div id="hauptspeisen-container"></div>
            <button type="button" onclick="addHauptspeise()">+ Hauptspeise hinzuf√ºgen</button>
            
            <h3>üç∞ Nachspeisen</h3>
            <div id="nachspeisen-container"></div>
            <button type="button" onclick="addNachspeise()">+ Nachspeise hinzuf√ºgen</button>
            
            <button onclick="speichereAuftrag()">‚úÖ Auftrag speichern</button>
        </div>
        
        <div class="auftraege-liste">
            <h2>üìã Auftr√§ge</h2>
            
            <div class="row">
                <div class="col">
                    <label for="filterTyp">Filter-Art:</label>
                    <select id="filterTyp" onchange="updateFilterOptions()">
                        <option value="alle">Alle Auftr√§ge anzeigen</option>
                        <option value="datum">Nach Datum filtern</option>
                        <option value="woche">Nach Kalenderwoche filtern</option>
                    </select>
                </div>
                <div class="col">
                    <label for="filterWert">Filter:</label>
                    <input type="date" id="filterWert" onchange="zeigeAuftraege()" style="display: none;">
                    <select id="filterWoche" onchange="zeigeAuftraege()" style="display: none;">
                        <option value="">-- Kalenderwoche w√§hlen --</option>
                    </select>
                </div>
            </div>
            
            <button onclick="druckeAuswahl()" style="margin-bottom: 20px;">üñ®Ô∏è Auswahl drucken</button>
            
            <div class="data-management">
                <h4>üíæ Datenverwaltung:</h4>
                <button onclick="exportiereBackup()" class="export-btn">
                    üì§ Backup exportieren
                </button>
                <button onclick="importiereBackup()" class="import-btn">
                    üì• Backup importieren
                </button>
                <button onclick="loescheAlleDaten()" class="delete-btn">
                    üóëÔ∏è Alle Daten l√∂schen
                </button>
                <p>üí° Tipp: Exportieren Sie regelm√§√üig Backups Ihrer Auftr√§ge!</p>
            </div>
            
            <div id="liste">
                <p style="color: #666;">Noch keine Auftr√§ge vorhanden.</p>
            </div>
        </div>
        
        <div class="form-section">
            <h2>üõí Bedarfsliste</h2>
            
            <div class="row">
                <div class="col">
                    <label for="bedarfWoche">Kalenderwoche f√ºr Bedarfsliste:</label>
                    <select id="bedarfWoche">
                        <option value="">-- Kalenderwoche w√§hlen --</option>
                    </select>
                </div>
                <div class="col">
                    <button onclick="erstelleBedarfsliste()" style="background: #28a745;">
                        üìä Bedarfsliste erstellen
                    </button>
                </div>
            </div>
            
            <div id="bedarfsliste-output" style="margin-top: 20px;">
                <p style="color: #666;">W√§hlen Sie eine Kalenderwoche aus, um die Bedarfsliste zu erstellen.</p>
            </div>
        </div>
    </div>

    <script>
        let auftraege = [];
        
        // Zutatendatenbank f√ºr Vorspeisen
        const zutatenDatenbank = {
            'Kartoffelsuppe Vegetarisch': {
                'Suppengr√ºn TK': { menge: 2.5, einheit: 'kg' },
                'Kartoffelp√ºrrepulver': { menge: 3, einheit: 'T√ºten' }
            },
            'Kartoffelsuppe mit W√ºrstchen': {
                'Suppengr√ºn TK': { menge: 2.5, einheit: 'kg' },
                'Kartoffelp√ºrrepulver': { menge: 3, einheit: 'T√ºten' },
                'Wiener W√ºrstchen': { menge: 10, einheit: 'St√ºck' }
            },
            'Gulaschsuppe': {
                'Schweineschulter': { menge: 1.5, einheit: 'kg' },
                'Zwiebelw√ºrfel TK': { menge: 1.0, einheit: 'kg' },
                'Paprika AS TK': { menge: 0.375, einheit: 'kg' },
                'Gulaschsuppengew√ºrz': { menge: 0.05, einheit: 'kg' }
            },
            'Lauch Hack Suppe': {
                'Lauch TK': { menge: 2.5, einheit: 'kg' },
                'Hack gemischt': { menge: 2.5, einheit: 'kg' },
                'Kr√§uterfrischk√§se': { menge: 0.9, einheit: 'kg' }
            },
            'Broccolicremesuppe': {
                'Broccoli TK': { menge: 2.5, einheit: 'kg' },
                'Kr√§uterfrischk√§se': { menge: 0.6, einheit: 'kg' },
                'Sahne': { menge: 0.5, einheit: 'L' }
            },
            'Chilli Con Carne': {
                'Zwiebelw√ºrfel TK': { menge: 1.25, einheit: 'kg' },
                'Hack gemischt': { menge: 2.5, einheit: 'kg' },
                'Speckw√ºrfel': { menge: 1.25, einheit: 'kg' },
                'Kidneybohnen (Dose)': { menge: 0.5, einheit: 'Dosen' },
                'Mais (Dose)': { menge: 0.5, einheit: 'Dosen' },
                'Gesch√§lte Tomaten (Dose)': { menge: 0.5, einheit: 'Dosen' },
                'Gulaschsuppengew√ºrz': { menge: 0.05, einheit: 'kg' },
                'Tomatenmark (Dose)': { menge: 0.25, einheit: 'Dosen' }
            },
            'Chilli Sin Carne': {
                'Zwiebelw√ºrfel TK': { menge: 1.25, einheit: 'kg' },
                'Kidneybohnen (Dose)': { menge: 0.5, einheit: 'Dosen' },
                'Mais (Dose)': { menge: 0.5, einheit: 'Dosen' },
                'Gesch√§lte Tomaten (Dose)': { menge: 0.5, einheit: 'Dosen' },
                'Gulaschsuppengew√ºrz': { menge: 0.05, einheit: 'kg' },
                'Tomatenmark (Dose)': { menge: 0.25, einheit: 'Dosen' }
            }
        };
        
        // Beilagen-Datenbank
        const beilagenDatenbank = {
            'Kartoffelgratin': {
                'Kartoffel in Scheiben (2kg Paket)': { menge: 0.125, einheit: 'Paket' },
                'Frische Eier': { menge: 0.083, einheit: 'St√ºck' },
                'Vollei (Paket)': { menge: 0.0083, einheit: 'Paket' },
                'Sahne': { menge: 0.0167, einheit: 'L' },
                'K√§segratinso√üe': { menge: 0.025, einheit: 'L' },
                'Milch': { menge: 0.025, einheit: 'L' }
            },
            'Bratkartoffeln': {
                'Kartoffel in Scheiben (2kg Paket)': { menge: 0.125, einheit: 'Paket' }
            },
            'R√∂stkartoffeln': {
                'Kartoffeln vfk (2,5kg Netz)': { menge: 0.125, einheit: 'Netz' }
            },
            'Kartoffelspalten': {
                'Kartoffeln vfk (2,5kg Netz)': { menge: 0.125, einheit: 'Netz' }
            },
            'Salzkartoffeln': {
                'Kartoffeln festkochend (2,5kg Netz)': { menge: 0.111, einheit: 'Netz' }
            },
            'Reis': {
                'Reis (Beutel)': { menge: 0.1, einheit: 'Beutel' }
            },
            'Kartoffelkl√∂√üe': {
                'Kartoffelkl√∂√üe (24er Beutel)': { menge: 0.083, einheit: 'Beutel' }
            },
            'Erbsen & M√∂hren': {
                'Erbsen & M√∂hren (Karton)': { menge: 0.025, einheit: 'Karton' }
            },
            'Rosenkohl': {
                'Rosenkohl (Karton)': { menge: 0.025, einheit: 'Karton' }
            },
            'Blumenkohl': {
                'Blumenkohl (Karton)': { menge: 0.025, einheit: 'Karton' }
            },
            'Rotkohl': {
                'Rotkohl (4kg Dose)': { menge: 0.0625, einheit: 'Dosen' }
            },
            'geschmortes Kraut': {
                'Geschmortes Kraut (10kg Dose)': { menge: 0.025, einheit: 'Dosen' }
            },
            'bunte Gem√ºseauswahl': {
                'Erbsen & M√∂hren (Karton)': { menge: 0.0083, einheit: 'Karton' },
                'Rosenkohl (Karton)': { menge: 0.0083, einheit: 'Karton' },
                'Blumenkohl (Karton)': { menge: 0.0083, einheit: 'Karton' }
            },
            'Kartoffelsalat': {
                'Kartoffel in Scheiben (2kg Paket)': { menge: 0.1, einheit: 'Paket' }
            },
            'Speckkartoffelsalat': {
                'Kartoffel in Scheiben (2kg Paket)': { menge: 0.1, einheit: 'Paket' }
            },
            'Nudelsalat': {
                'Nudeln (5kg Sack)': { menge: 0.033, einheit: 'Sack' },
                'Mexico Mix klein (Dose)': { menge: 0.1, einheit: 'Dosen' }
            },
            'Krautsalat in Yogurtso√üe': {
                'Wei√ükohl': { menge: 0.1875, einheit: 'kg' },
                'Gr√ºne Paprika (frisch)': { menge: 0.025, einheit: 'St√ºck' },
                'Knoblauch': { menge: 0.0025, einheit: 'kg' }
            },
            'Krautsalat Natur': {
                'Krautsalat Natur (5kg Eimer)': { menge: 0.05, einheit: 'Eimer' }
            },
            'frischer gemischter Salat': {
                'Zutaten f√ºr frische Salate besorgen': { menge: 1, einheit: 'Salat' }
            },
            'Eisberg Melonen Salat': {
                'Zutaten f√ºr frische Salate besorgen': { menge: 1, einheit: 'Salat' }
            },
            'Griechischer Salat': {
                'Zutaten f√ºr frische Salate besorgen': { menge: 1, einheit: 'Salat' }
            }
        };
        
        // Vorspeisen hinzuf√ºgen
        function addVorspeise() {
            const container = document.getElementById('vorspeisen-container');
            const block = document.createElement('div');
            block.className = 'speise-block';
            block.innerHTML = `
                <label>Vorspeise:</label>
                <select>
                    <option>-- Bitte w√§hlen --</option>
                    <option>Kartoffelsuppe mit W√ºrstchen</option>
                    <option>Kartoffelsuppe Vegetarisch</option>
                    <option>Lauch Hack Suppe</option>
                    <option>Gulaschsuppe</option>
                    <option>Broccolicremesuppe</option>
                    <option>Chilli Con Carne</option>
                    <option>Chilli Sin Carne</option>
                </select>
                <label>Personenzahl:</label>
                <input type="number" min="1" placeholder="Anzahl Personen">
                <label><input type="checkbox"> Brot dazu?</label>
                <button type="button" onclick="this.parentElement.remove()">üóëÔ∏è Entfernen</button>
            `;
            container.appendChild(block);
        }
        
        // Hauptspeisen hinzuf√ºgen
        function addHauptspeise() {
            const container = document.getElementById('hauptspeisen-container');
            const block = document.createElement('div');
            block.className = 'speise-block';
            const beilagenId = 'beilagen_' + Date.now();
            block.innerHTML = `
                <label>Hauptspeise:</label>
                <select>
                    <option>-- Bitte w√§hlen --</option>
                    <option>Spanferkel mit Beilagen</option>
                    <option>BBQ Schwein mit Beilagen</option>
                    <option>Spanferkel ohne Beilagen</option>
                    <option>BBQ Schwein ohne Beilagen</option>
                    <option>Honigschinken</option>
                    <option>Grillschinken</option>
                    <option>Glasierte Pute</option>
                    <option>Rinderbraten</option>
                    <option>Rinderrouladen</option>
                    <option>Kr√§uterbraten</option>
                    <option>Gyrosbraten</option>
                    <option>Griechischer Rahmbraten</option>
                    <option>Spie√übraten</option>
                    <option>Altdeutscher Bierbraten</option>
                    <option>Schweinefilet in Sahnesauce</option>
                    <option>Kassler im Bl√§tterteig</option>
                    <option>Bayrischer Leberk√§se</option>
                    <option>Gr√ºnkohl</option>
                    <option>Wildschweinbraten</option>
                    <option>Vegetarische Gem√ºseschnitzel</option>
                    <option>Amerikanische Knabbereien</option>
                    <option>Pulled Pork</option>
                </select>
                <label>Personenzahl:</label>
                <input type="number" min="1" placeholder="Anzahl Personen">
                <div class="beilagen-container" id="${beilagenId}"></div>
                <button type="button" onclick="addBeilage('${beilagenId}')">+ Beilage hinzuf√ºgen</button>
                <button type="button" onclick="this.parentElement.remove()">üóëÔ∏è Hauptspeise entfernen</button>
            `;
            container.appendChild(block);
        }
        
        // Beilagen hinzuf√ºgen
        function addBeilage(containerId) {
            const container = document.getElementById(containerId);
            const block = document.createElement('div');
            block.className = 'speise-block';
            block.style.marginLeft = '0';
            block.innerHTML = `
                <label>Beilage:</label>
                <select>
                    <option disabled>-- Kartoffelbeilagen --</option>
                    <option>Kartoffelgratin</option>
                    <option>R√∂stkartoffeln</option>
                    <option>Kartoffelspalten</option>
                    <option>Salzkartoffeln</option>
                    <option>Bratkartoffeln</option>
                    <option>Kartoffelkl√∂√üe</option>
                    <option>Reis</option>
                    <option disabled>-- Gem√ºse --</option>
                    <option>bunte Gem√ºseauswahl</option>
                    <option>geschmortes Kraut</option>
                    <option>Rotkohl</option>
                    <option>Erbsen & M√∂hren</option>
                    <option>Rosenkohl</option>
                    <option>Blumenkohl</option>
                    <option disabled>-- Salate --</option>
                    <option>Kartoffelsalat</option>
                    <option>Speckkartoffelsalat</option>
                    <option>Nudelsalat</option>
                    <option>frischer gemischter Salat</option>
                    <option>Eisberg Melonen Salat</option>
                    <option>Griechischer Salat</option>
                    <option>Krautsalat Natur</option>
                    <option>Krautsalat in Yogurtso√üe</option>
                </select>
                <label>Personenzahl:</label>
                <input type="number" min="1" placeholder="Anzahl Personen">
                <button type="button" onclick="this.parentElement.remove()">üóëÔ∏è Beilage entfernen</button>
            `;
            container.appendChild(block);
        }
        
        // Nachspeisen hinzuf√ºgen (erweitert f√ºr Backshop)
        function addNachspeise() {
            const container = document.getElementById('nachspeisen-container');
            const block = document.createElement('div');
            block.className = 'speise-block';
            const geschmackId = 'geschmack_' + Date.now();
            const detailId = 'detail_' + Date.now();
            block.innerHTML = `
                <label>Nachspeisen-Kategorie:</label>
                <select onchange="updateGeschmackOptionen('${geschmackId}', this.value); resetDetailOptionen('${detailId}')">
                    <option>-- Bitte w√§hlen --</option>
                    <option value="N1">N1 (gro√üe Sch√ºssel)</option>
                    <option value="N2">N2 (kleine Portionssch√§lchen)</option>
                    <option value="N3">N3 (Spezialit√§ten)</option>
                    <option value="Backshop">Backshop</option>
                </select>
                <label>Artikel/Geschmacksrichtung:</label>
                <select id="${geschmackId}" onchange="updateDetailOptionen('${detailId}', this.value)" disabled>
                    <option>-- Erst Kategorie w√§hlen --</option>
                </select>
                <div id="detail-container-${detailId}" style="display: none;">
                    <label id="detail-label-${detailId}">Auswahl:</label>
                    <select id="${detailId}">
                        <option>-- Erst Artikel w√§hlen --</option>
                    </select>
                </div>
                <label>Anzahl/Personenzahl:</label>
                <input type="number" min="1" placeholder="Anzahl Personen/St√ºck">
                <button type="button" onclick="this.parentElement.remove()">üóëÔ∏è Entfernen</button>
            `;
            container.appendChild(block);
        }
        
        // Geschmacksoptionen f√ºr Nachspeisen aktualisieren
        function updateGeschmackOptionen(geschmackId, kategorie) {
            const geschmackSelect = document.getElementById(geschmackId);
            
            if (!kategorie || kategorie === '-- Bitte w√§hlen --') {
                geschmackSelect.disabled = true;
                geschmackSelect.innerHTML = '<option>-- Erst Kategorie w√§hlen --</option>';
                return;
            }
            
            geschmackSelect.disabled = false;
            geschmackSelect.innerHTML = '<option>-- Geschmack w√§hlen --</option>';
            
            if (kategorie === 'N1' || kategorie === 'N2') {
                const optionen = [
                    'Mousse au Chocolat',
                    'Vanille-Mousse',
                    'Stracciatella-Mousse',
                    'Tiramisu',
                    'Rote Gr√ºtze mit Vanillesauce',
                    'Mascarponequark mit Himbeermark',
                    'Obstsalat (je nach Verf√ºgbarkeit)'
                ];
                
                optionen.forEach(option => {
                    geschmackSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else if (kategorie === 'N3') {
                const optionen = [
                    'Bayrische Creme mit Tellerbiskuit und Erdbeere',
                    'Karamell mit Schokoso√üe',
                    'Frischk√§secreme mit Aprikose',
                    'Schwarzw√§lder Kirsch',
                    'Joghurtcreme mit zweierlei von der Himbeere'
                ];
                
                optionen.forEach(option => {
                    geschmackSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else if (kategorie === 'Backshop') {
                const optionen = [
                    'halbe belegte Br√∂tchen hell (Normalbelag)',
                    'halbe belegte Br√∂tchen dunkel (Normalbelag)',
                    'halbe belegte Br√∂tchen hell (Premiumbelag)',
                    'halbe belegte Br√∂tchen dunkel (Premiumbelag)',
                    'halbe belegte Bagel',
                    'Muffins',
                    'Donuts',
                    'Blechkuchen'
                ];
                
                optionen.forEach(option => {
                    geschmackSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            }
        }
        
        // Nachspeisen hinzuf√ºgen (erweitert f√ºr Backshop)
        function addNachspeise() {
            const container = document.getElementById('nachspeisen-container');
            const block = document.createElement('div');
            block.className = 'speise-block';
            const geschmackId = 'geschmack_' + Date.now();
            const detailId = 'detail_' + Date.now();
            block.innerHTML = `
                <label>Nachspeisen-Kategorie:</label>
                <select onchange="updateGeschmackOptionen('${geschmackId}', this.value); resetDetailOptionen('${detailId}')">
                    <option>-- Bitte w√§hlen --</option>
                    <option value="N1">N1 (gro√üe Sch√ºssel)</option>
                    <option value="N2">N2 (kleine Portionssch√§lchen)</option>
                    <option value="N3">N3 (Spezialit√§ten)</option>
                    <option value="Backshop">Backshop</option>
                </select>
                <label>Artikel/Geschmacksrichtung:</label>
                <select id="${geschmackId}" onchange="updateDetailOptionen('${detailId}', this.value)" disabled>
                    <option>-- Erst Kategorie w√§hlen --</option>
                </select>
                <div id="detail-container-${detailId}" style="display: none;">
                    <label id="detail-label-${detailId}">Auswahl:</label>
                    <select id="${detailId}">
                        <option>-- Erst Artikel w√§hlen --</option>
                    </select>
                </div>
                <label>Anzahl/Personenzahl:</label>
                <input type="number" min="1" placeholder="Anzahl Personen/St√ºck">
                <button type="button" onclick="this.parentElement.remove()">üóëÔ∏è Entfernen</button>
            `;
            container.appendChild(block);
        }
        
        // Detail-Optionen f√ºr Backshop-Artikel aktualisieren
        function updateDetailOptionen(detailId, artikel) {
            const detailSelect = document.getElementById(detailId);
            const detailContainer = document.getElementById(`detail-container-${detailId}`);
            const detailLabel = document.getElementById(`detail-label-${detailId}`);
            
            if (!artikel || artikel === '-- Geschmack w√§hlen --') {
                detailContainer.style.display = 'none';
                return;
            }
            
            detailSelect.innerHTML = '<option>-- Bitte w√§hlen --</option>';
            
            if (artikel.includes('Normalbelag')) {
                detailContainer.style.display = 'block';
                detailLabel.textContent = 'Belag-Auswahl:';
                const optionen = ['K√§se', 'Brie', 'Salami', 'Pute', 'Schinken', 'Kr√§uterquark', 'Sonstiges'];
                optionen.forEach(option => {
                    detailSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else if (artikel.includes('Premiumbelag')) {
                detailContainer.style.display = 'block';
                detailLabel.textContent = 'Premium-Belag:';
                const optionen = ['Blauschimmelk√§se', 'Lachs', 'Krabben', 'Sonstiges'];
                optionen.forEach(option => {
                    detailSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else if (artikel.includes('Bagel')) {
                detailContainer.style.display = 'block';
                detailLabel.textContent = 'Bagel-Belag:';
                const optionen = ['Tomate Mozzarella', 'Salami', 'Schinken', 'K√§se', 'Schinken-K√§se'];
                optionen.forEach(option => {
                    detailSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else if (artikel === 'Muffins') {
                detailContainer.style.display = 'block';
                detailLabel.textContent = 'Muffin-Geschmack:';
                const optionen = ['Blaubeere', 'Apfel', 'Marmor', 'Schoko'];
                optionen.forEach(option => {
                    detailSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else if (artikel === 'Donuts') {
                detailContainer.style.display = 'block';
                detailLabel.textContent = 'Donut-Geschmack:';
                const optionen = ['K√§sekuchen', 'Vanille', 'Schoko', 'Kaugummi', 'Pinky Crunch'];
                optionen.forEach(option => {
                    detailSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else if (artikel === 'Blechkuchen') {
                detailContainer.style.display = 'block';
                detailLabel.textContent = 'Kuchen-Sorte:';
                const optionen = ['Zitronenkuchen', 'Quark-Mandarine', 'Quark-Kirsche', 'Apfelkuchen mit Zimt', 'Butterkuchen mit Mandeln', 'Schokokuchen'];
                optionen.forEach(option => {
                    detailSelect.innerHTML += `<option value="${option}">${option}</option>`;
                });
            } else {
                detailContainer.style.display = 'none';
            }
        }
        
        // Detail-Optionen zur√ºcksetzen
        function resetDetailOptionen(detailId) {
            const detailContainer = document.getElementById(`detail-container-${detailId}`);
            if (detailContainer) {
                detailContainer.style.display = 'none';
            }
        }
        
        // Speisen sammeln
        function sammeleSpeisen() {
            const vorspeisen = [];
            const hauptspeisen = [];
            const beilagen = [];
            const nachspeisen = [];
            
            // Vorspeisen sammeln
            document.querySelectorAll('#vorspeisen-container .speise-block').forEach((block) => {
                const select = block.querySelector('select');
                const anzahl = block.querySelector('input[type="number"]');
                const brot = block.querySelector('input[type="checkbox"]');
                
                if (select && anzahl && select.value !== '-- Bitte w√§hlen --' && parseInt(anzahl.value) > 0) {
                    vorspeisen.push({
                        speise: select.value,
                        anzahl: parseInt(anzahl.value),
                        brot: brot ? brot.checked : false
                    });
                }
            });
            
            // Hauptspeisen sammeln
            document.querySelectorAll('#hauptspeisen-container .speise-block').forEach((block) => {
                const select = block.querySelector('select');
                const anzahl = block.querySelector('input[type="number"]');
                
                if (select && anzahl && select.value !== '-- Bitte w√§hlen --' && parseInt(anzahl.value) > 0) {
                    hauptspeisen.push({
                        speise: select.value,
                        anzahl: parseInt(anzahl.value)
                    });
                }
                
                // Beilagen sammeln
                block.querySelectorAll('.beilagen-container .speise-block').forEach((beilageBlock) => {
                    const beilageSelect = beilageBlock.querySelector('select');
                    const beilageAnzahl = beilageBlock.querySelector('input[type="number"]');
                    
                    if (beilageSelect && beilageAnzahl && beilageSelect.value && parseInt(beilageAnzahl.value) > 0) {
                        beilagen.push({
                            speise: beilageSelect.value,
                            anzahl: parseInt(beilageAnzahl.value)
                        });
                    }
                });
            });
            
            // Nachspeisen sammeln
            document.querySelectorAll('#nachspeisen-container .speise-block').forEach((block) => {
                const kategorieSelect = block.querySelector('select');
                const geschmackSelect = block.querySelectorAll('select')[1]; // Zweites Select-Element
                const detailSelect = block.querySelectorAll('select')[2]; // Drittes Select-Element (falls vorhanden)
                const anzahl = block.querySelector('input[type="number"]');
                
                if (kategorieSelect && geschmackSelect && anzahl && 
                    kategorieSelect.value !== '-- Bitte w√§hlen --' && 
                    geschmackSelect.value !== '-- Geschmack w√§hlen --' && 
                    geschmackSelect.value !== '-- Erst Kategorie w√§hlen --' && 
                    parseInt(anzahl.value) > 0) {
                    
                    let speiseText = geschmackSelect.value;
                    
                    // Wenn Detail-Auswahl vorhanden und ausgew√§hlt, anh√§ngen
                    if (detailSelect && detailSelect.value && detailSelect.value !== '-- Bitte w√§hlen --' && detailSelect.value !== '-- Erst Artikel w√§hlen --') {
                        speiseText += ` (${detailSelect.value})`;
                    }
                    
                    nachspeisen.push({
                        kategorie: kategorieSelect.value,
                        speise: speiseText,
                        anzahl: parseInt(anzahl.value)
                    });
                }
            });
            
            return { vorspeisen, hauptspeisen, beilagen, nachspeisen };
        }
        
        // Beilagen zusammenfassen
        function fasseBeilagenZusammen(beilagen) {
            const zusammengefasst = {};
            
            beilagen.forEach(beilage => {
                if (zusammengefasst[beilage.speise]) {
                    zusammengefasst[beilage.speise] += beilage.anzahl;
                } else {
                    zusammengefasst[beilage.speise] = beilage.anzahl;
                }
            });
            
            return Object.entries(zusammengefasst).map(([speise, anzahl]) => ({
                speise: speise,
                anzahl: anzahl
            }));
        }
        
        // Auftrag speichern
        function speichereAuftrag() {
            const kunde = document.getElementById('kunde').value;
            const telefon = document.getElementById('telefon').value;
            const notizen = document.getElementById('notizen').value;
            const datum = document.getElementById('datum').value;
            const stunden = document.getElementById('stunden').value;
            const minuten = document.getElementById('minuten').value;
            const ort = document.getElementById('ort').value;
            const gaeste = document.getElementById('gaeste').value;
            
            if (!kunde || !datum || !stunden || !minuten || !ort || !gaeste) {
                alert('Bitte f√ºllen Sie alle Pflichtfelder aus!');
                return;
            }
            
            const speisen = sammeleSpeisen();
            const beilagenZusammengefasst = fasseBeilagenZusammen(speisen.beilagen);
            
            const auftrag = {
                id: Date.now(),
                kunde: kunde,
                telefon: telefon,
                notizen: notizen,
                datum: datum,
                zeit: stunden + ':' + minuten,
                ort: ort,
                gaeste: parseInt(gaeste),
                vorspeisen: speisen.vorspeisen,
                hauptspeisen: speisen.hauptspeisen,
                beilagen: beilagenZusammengefasst,
                nachspeisen: speisen.nachspeisen
            };
            
            auftraege.push(auftrag);
            zeigeAuftraege();
            updateStats();
            updateBedarfsWochen();
            
            // Formular leeren
            document.getElementById('kunde').value = '';
            document.getElementById('telefon').value = '';
            document.getElementById('notizen').value = '';
            document.getElementById('datum').value = '';
            document.getElementById('stunden').value = '';
            document.getElementById('minuten').value = '';
            document.getElementById('ort').value = '';
            document.getElementById('gaeste').value = '';
            document.getElementById('vorspeisen-container').innerHTML = '';
            document.getElementById('hauptspeisen-container').innerHTML = '';
            document.getElementById('nachspeisen-container').innerHTML = '';
            
            alert('Auftrag erfolgreich gespeichert!');
        }
        
        // Berechnungsfunktionen
        function berechneHauptspeise(speise, anzahl) {
            let ergebnis = { gewicht: 0, einheit: 'g', zusatz: '' };
            
            switch(speise) {
                case 'Spanferkel mit Beilagen':
                case 'Spanferkel ohne Beilagen':
                case 'BBQ Schwein mit Beilagen':
                case 'BBQ Schwein ohne Beilagen':
                    ergebnis.gewicht = anzahl * 650;
                    if (speise.includes('mit Beilagen')) {
                        const brote = Math.ceil(anzahl / 10);
                        ergebnis.zusatz = ` + ${brote} Brot${brote > 1 ? 'e' : ''}`;
                    }
                    break;
                    
                case 'Pulled Pork':
                    ergebnis.gewicht = anzahl * 300;
                    const brotePulled = Math.ceil(anzahl / 10);
                    ergebnis.zusatz = ` + ${brotePulled} Brot${brotePulled > 1 ? 'e' : ''}`;
                    break;
                    
                case 'Rinderrouladen':
                    ergebnis.gewicht = anzahl * 300;
                    break;
                    
                case 'Vegetarische Gem√ºseschnitzel':
                    ergebnis.gewicht = 0;
                    ergebnis.einheit = 'St√ºck';
                    ergebnis.zusatz = `${anzahl * 2} Schnitzel`;
                    return ergebnis;
                    
                case 'Amerikanische Knabbereien':
                    const rippen = Math.ceil((anzahl / 5) * 3);
                    const wings = anzahl * 4;
                    const finger = anzahl * 4;
                    const broteAmerikan = Math.ceil(anzahl / 10);
                    
                    ergebnis.gewicht = 0;
                    ergebnis.einheit = '';
                    ergebnis.zusatz = `${rippen} Rippen, ${wings} Wings, ${finger} Chicken Finger + ${broteAmerikan} Brot${broteAmerikan > 1 ? 'e' : ''}`;
                    return ergebnis;
                    
                default:
                    ergebnis.gewicht = anzahl * 250;
            }
            
            return ergebnis;
        }
        
        // Auftr√§ge anzeigen
        function zeigeAuftraege() {
            const liste = document.getElementById('liste');
            
            if (auftraege.length === 0) {
                liste.innerHTML = '<p style="color: #666;">Noch keine Auftr√§ge vorhanden.</p>';
                return;
            }
            
            auftraege.sort((a, b) => new Date(a.datum + 'T' + a.zeit) - new Date(b.datum + 'T' + b.zeit));
            
            let html = '<div class="auftraege-grid">';
            auftraege.forEach(auftrag => {
                const kw = getWeekNumber(auftrag.datum);
                let speisenHtml = '';
                
                if (auftrag.vorspeisen && auftrag.vorspeisen.length > 0) {
                    speisenHtml += '<br><strong>Vorspeisen:</strong><br>';
                    auftrag.vorspeisen.forEach(v => {
                        const liter = v.anzahl * 0.5;
                        const literText = liter >= 1 ? `${liter.toFixed(1)} L` : `${(liter * 1000)} ml`;
                        const brotText = v.brot ? ` + ${Math.ceil(v.anzahl / 6)} Brot${Math.ceil(v.anzahl / 6) > 1 ? 'e' : ''}` : '';
                        speisenHtml += `‚Ä¢ ${v.speise} (${v.anzahl} Pers., ${literText})${brotText}<br>`;
                    });
                }
                
                if (auftrag.hauptspeisen && auftrag.hauptspeisen.length > 0) {
                    speisenHtml += '<br><strong>Hauptspeisen:</strong><br>';
                    auftrag.hauptspeisen.forEach(h => {
                        const berechnung = berechneHauptspeise(h.speise, h.anzahl);
                        
                        if (berechnung.gewicht > 0) {
                            const gewichtText = berechnung.gewicht >= 1000 ? `${(berechnung.gewicht/1000).toFixed(1)} kg` : `${berechnung.gewicht} g`;
                            speisenHtml += `‚Ä¢ ${h.speise} (${h.anzahl} Pers., ${gewichtText})${berechnung.zusatz}<br>`;
                        } else if (berechnung.zusatz.includes('Schnitzel')) {
                            speisenHtml += `‚Ä¢ ${h.speise} (${h.anzahl} Pers., ${berechnung.zusatz})<br>`;
                        } else {
                            speisenHtml += `‚Ä¢ ${h.speise} (${h.anzahl} Pers.)${berechnung.zusatz}<br>`;
                        }
                    });
                }
                
                if (auftrag.beilagen && auftrag.beilagen.length > 0) {
                    speisenHtml += '<br><strong>Beilagen:</strong><br>';
                    auftrag.beilagen.forEach(b => {
                        const nurPersonenSalate = ['frischer gemischter Salat', 'Griechischer Salat', 'Eisberg Melonen Salat'];
                        
                        if (nurPersonenSalate.includes(b.speise)) {
                            speisenHtml += `‚Ä¢ ${b.speise} (${b.anzahl} Pers.)<br>`;
                        } else {
                            const gewicht = b.anzahl * 250;
                            const gewichtText = gewicht >= 1000 ? `${(gewicht/1000).toFixed(1)} kg` : `${gewicht} g`;
                            speisenHtml += `‚Ä¢ ${b.speise} (${b.anzahl} Pers., ${gewichtText})<br>`;
                        }
                    });
                }
                
                if (auftrag.nachspeisen && auftrag.nachspeisen.length > 0) {
                    speisenHtml += '<br><strong>Nachspeisen:</strong><br>';
                    auftrag.nachspeisen.forEach(n => {
                        const gewicht = n.anzahl * 120;
                        const gewichtText = gewicht >= 1000 ? `${(gewicht/1000).toFixed(1)} kg` : `${gewicht} g`;
                        const kategorieText = n.kategorie ? `[${n.kategorie}] ` : '';
                        speisenHtml += `‚Ä¢ ${kategorieText}${n.speise} (${n.anzahl} Pers., ${gewichtText})<br>`;
                    });
                }
                
                html += `
                    <div class="auftrag">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <input type="checkbox" class="druckauswahl" data-id="${auftrag.id}" style="width: auto; margin-right: 10px;">
                            <strong style="font-size: 1.1em; color: #667eea;">${auftrag.kunde}</strong>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span><strong>üìÖ ${auftrag.datum}</strong></span>
                                <span><strong>üïê ${auftrag.zeit}</strong></span>
                                <small style="color: #6c757d;">(KW ${kw})</small>
                            </div>
                            ${auftrag.telefon ? `<div style="margin-bottom: 5px;">üìû ${auftrag.telefon}</div>` : ''}
                            <div style="margin-bottom: 5px;">üìç ${auftrag.ort}</div>
                            <div><strong>üë• ${auftrag.gaeste} G√§ste</strong></div>
                            ${auftrag.notizen ? `<div style="margin-top: 8px; padding: 8px; background: #fff3cd; border-radius: 4px; font-style: italic;">üìù ${auftrag.notizen}</div>` : ''}
                        </div>
                        
                        <div style="font-size: 0.95em; line-height: 1.4;">
                            ${speisenHtml}
                        </div>
                        
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button onclick="loescheAuftrag(${auftrag.id})" style="width: auto; padding: 8px 12px; background: #dc3545; font-size: 0.9em;">
                                üóëÔ∏è L√∂schen
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            liste.innerHTML = html;
        }
        
        // Bedarfsliste erstellen
        function erstelleBedarfsliste() {
            const selectedWoche = document.getElementById('bedarfWoche').value;
            const output = document.getElementById('bedarfsliste-output');
            
            if (!selectedWoche) {
                output.innerHTML = '<p style="color: #666;">Bitte w√§hlen Sie eine Kalenderwoche aus.</p>';
                return;
            }
            
            const [jahr, woche] = selectedWoche.split('-').map(Number);
            const { start, end } = getDateFromWeek(jahr, woche);
            
            const wochenAuftraege = auftraege.filter(a => {
                const auftragsDatum = new Date(a.datum);
                return auftragsDatum >= start && auftragsDatum <= end;
            });
            
            if (wochenAuftraege.length === 0) {
                output.innerHTML = `
                    <div style="padding: 20px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffeaa7;">
                        <h4>‚ö†Ô∏è Keine Auftr√§ge gefunden</h4>
                        <p>F√ºr KW ${woche}/${jahr} sind keine Auftr√§ge vorhanden.</p>
                    </div>
                `;
                return;
            }
            
            const gesamtBedarf = {};
            
            wochenAuftraege.forEach(auftrag => {
                // Vorspeisen analysieren
                if (auftrag.vorspeisen) {
                    auftrag.vorspeisen.forEach(vorspeise => {
                        if (zutatenDatenbank[vorspeise.speise]) {
                            const benoetigteLiter = vorspeise.anzahl * 0.5;
                            const fuenfLiterEinheiten = benoetigteLiter / 5;
                            
                            const zutaten = zutatenDatenbank[vorspeise.speise];
                            for (const [zutat, info] of Object.entries(zutaten)) {
                                const benoetigteMenge = info.menge * fuenfLiterEinheiten;
                                
                                if (!gesamtBedarf[zutat]) {
                                    gesamtBedarf[zutat] = { menge: 0, einheit: info.einheit };
                                }
                                gesamtBedarf[zutat].menge += benoetigteMenge;
                            }
                        }
                    });
                }
                
                // Beilagen analysieren
                if (auftrag.beilagen) {
                    auftrag.beilagen.forEach(beilage => {
                        if (beilagenDatenbank[beilage.speise]) {
                            const rezept = beilagenDatenbank[beilage.speise];
                            
                            for (const [zutat, info] of Object.entries(rezept)) {
                                const benoetigteMenge = info.menge * beilage.anzahl;
                                
                                if (!gesamtBedarf[zutat]) {
                                    gesamtBedarf[zutat] = { menge: 0, einheit: info.einheit };
                                }
                                gesamtBedarf[zutat].menge += benoetigteMenge;
                            }
                        }
                    });
                }
            });
            
            let bedarfsHtml = `
                <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #28a745;">
                    <h3 style="color: #28a745; margin-top: 0;">üõí Bedarfsliste KW ${woche}/${jahr}</h3>
                    <p><strong>Zeitraum:</strong> ${start.toLocaleDateString('de-DE')} - ${end.toLocaleDateString('de-DE')}</p>
                    <p><strong>Auftr√§ge:</strong> ${wochenAuftraege.length}</p>
                    
                    <h4>üì¶ Ben√∂tigte Zutaten:</h4>
            `;
            
            if (Object.keys(gesamtBedarf).length > 0) {
                bedarfsHtml += '<ul style="list-style: none; padding: 0;">';
                for (const [zutat, info] of Object.entries(gesamtBedarf)) {
                    const anzeigeMenge = info.einheit === 'St√ºck' || info.einheit === 'T√ºten' || info.einheit === 'Dosen' || info.einheit === 'Paket' || info.einheit === 'Netz' ? 
                        Math.ceil(info.menge) : info.menge.toFixed(1);
                    bedarfsHtml += `<li style="padding: 8px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #28a745;">
                        <strong>${zutat}:</strong> ${anzeigeMenge} ${info.einheit}
                    </li>`;
                }
                bedarfsHtml += '</ul>';
            } else {
                bedarfsHtml += '<p style="color: #6c757d;">Keine Zutaten berechenbar (Rezepte noch nicht hinterlegt).</p>';
            }
            
            bedarfsHtml += '</div>';
            output.innerHTML = bedarfsHtml;
        }
        
        // Auftrag l√∂schen
        function loescheAuftrag(id) {
            if (confirm('Auftrag wirklich l√∂schen?')) {
                auftraege = auftraege.filter(a => a.id !== id);
                zeigeAuftraege();
                updateStats();
                updateBedarfsWochen();
            }
        }
        
        // Hilfsfunktionen
        function getWeekNumber(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 3 - (d.getDay() + 6) % 7);
            const week1 = new Date(d.getFullYear(), 0, 4);
            return 1 + Math.round(((d.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
        }

        function getDateFromWeek(year, week) {
            const jan4 = new Date(year, 0, 4);
            const dayOfWeek = jan4.getDay() || 7;
            const startOfWeek = new Date(jan4);
            startOfWeek.setDate(jan4.getDate() - dayOfWeek + 1 + (week - 1) * 7);
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            return { start: startOfWeek, end: endOfWeek };
        }
        
        // Filter-Funktionen
        function updateFilterOptions() {
            const filterTyp = document.getElementById('filterTyp').value;
            const filterWert = document.getElementById('filterWert');
            const filterWoche = document.getElementById('filterWoche');
            
            filterWert.style.display = 'none';
            filterWoche.style.display = 'none';
            
            if (filterTyp === 'datum') {
                filterWert.style.display = 'block';
            } else if (filterTyp === 'woche') {
                filterWoche.style.display = 'block';
                updateWochenOptionen();
            }
            
            zeigeAuftraege();
        }

        function updateWochenOptionen() {
            const filterWoche = document.getElementById('filterWoche');
            filterWoche.innerHTML = '<option value="">-- Kalenderwoche w√§hlen --</option>';
        }
        
        // Kalenderwochen f√ºr Bedarfsliste aktualisieren
        function updateBedarfsWochen() {
            const bedarfWoche = document.getElementById('bedarfWoche');
            const heute = new Date();
            const aktuelleKW = getWeekNumber(heute.toISOString().split('T')[0]);
            const aktuellesJahr = heute.getFullYear();
            
            bedarfWoche.innerHTML = '<option value="">-- Kalenderwoche w√§hlen --</option>';
            bedarfWoche.innerHTML += `<option value="${aktuellesJahr}-${aktuelleKW}">KW ${aktuelleKW}/${aktuellesJahr} (Diese Woche)</option>`;
            
            const naechsteWoche = new Date(heute);
            naechsteWoche.setDate(heute.getDate() + 7);
            const naechsteKW = getWeekNumber(naechsteWoche.toISOString().split('T')[0]);
            const naechstesJahr = naechsteWoche.getFullYear();
            bedarfWoche.innerHTML += `<option value="${naechstesJahr}-${naechsteKW}">KW ${naechsteKW}/${naechstesJahr} (N√§chste Woche)</option>`;
        }
        
        // Druck- und Backup-Funktionen
        function druckeAuswahl() {
            const ausgewaehlte = document.querySelectorAll('.druckauswahl:checked');
            if (ausgewaehlte.length === 0) {
                alert('Bitte w√§hlen Sie mindestens einen Auftrag aus.');
                return;
            }
            alert(`${ausgewaehlte.length} Auftrag/Auftr√§ge zum Drucken ausgew√§hlt. Druckfunktion ist vereinfacht implementiert.`);
        }
        
        function exportiereBackup() {
            const dateiName = `Partyservice_Backup_${new Date().toISOString().split('T')[0]}.json`;
            const datenString = JSON.stringify(auftraege, null, 2);
            
            const win = window.open('', '_blank');
            win.document.write(`
                <html>
                    <head>
                        <title>Backup-Daten</title>
                        <style>
                            body { font-family: monospace; margin: 20px; }
                            pre { background: #f5f5f5; padding: 20px; border-radius: 5px; white-space: pre-wrap; }
                        </style>
                    </head>
                    <body>
                        <h1>Backup-Daten (${dateiName})</h1>
                        <p>Kopieren Sie diese Daten und speichern Sie sie als JSON-Datei:</p>
                        <pre>${datenString}</pre>
                    </body>
                </html>
            `);
            
            alert('Backup erstellt! Die Daten werden in einem neuen Fenster angezeigt.');
        }
        
        function importiereBackup() {
            const jsonData = prompt('Bitte f√ºgen Sie Ihre Backup-JSON-Daten hier ein:');
            
            if (!jsonData) return;
            
            try {
                const importierteDaten = JSON.parse(jsonData);
                
                if (Array.isArray(importierteDaten)) {
                    if (confirm(`Import von ${importierteDaten.length} Auftr√§gen? Dies ersetzt alle aktuellen Daten!`)) {
                        auftraege = importierteDaten;
                        zeigeAuftraege();
                        updateStats();
                        updateBedarfsWochen();
                        alert(`${importierteDaten.length} Auftr√§ge erfolgreich importiert!`);
                    }
                } else {
                    alert('Ung√ºltiges Backup-Format!');
                }
            } catch (error) {
                alert('Fehler beim Importieren der Datei!');
            }
        }
        
        function loescheAlleDaten() {
            if (confirm('ACHTUNG: Alle Auftr√§ge l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!')) {
                auftraege = [];
                zeigeAuftraege();
                updateStats();
                updateBedarfsWochen();
                alert('Alle Auftr√§ge wurden gel√∂scht!');
            }
        }
        
        // Statistiken aktualisieren
        function updateStats() {
            const heute = new Date().toISOString().split('T')[0];
            const heuteCount = auftraege.filter(a => a.datum === heute).length;
            
            const heute_date = new Date();
            const montag = new Date(heute_date);
            montag.setDate(heute_date.getDate() - heute_date.getDay() + 1);
            const sonntag = new Date(montag);
            sonntag.setDate(montag.getDate() + 6);
            
            const wocheCount = auftraege.filter(a => {
                const auftragsDatum = new Date(a.datum);
                return auftragsDatum >= montag && auftragsDatum <= sonntag;
            }).length;
            
            document.getElementById('total').textContent = `Gesamt: ${auftraege.length}`;
            document.getElementById('today').textContent = `Heute: ${heuteCount}`;
            document.getElementById('week').textContent = `Diese Woche: ${wocheCount}`;
        }
        
        // Initialisierung
        window.onload = function() {
            updateStats();
            zeigeAuftraege();
            updateBedarfsWochen();
            console.log('Partyservice Kleinfeldt - Auftragserfassung vollst√§ndig geladen');
        };
    </script>
</body>
</html>