
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Partyservice Kleinfeldt – Auftragsplaner V18</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background-color: #f5f5f5; padding: 20px; max-width: 1200px; margin: auto; }
    header { display: flex; align-items: center; margin-bottom: 20px; }
    header img { height: 60px; margin-right: 15px; }
    h1 { color: #222; margin: 0; }
    .auftrag { background: white; padding: 15px; margin-top: 20px; border-radius: 6px; box-shadow: 0 0 5px rgba(0,0,0,0.1); position: relative; }
    .loeschen-btn { position: absolute; top: 10px; right: 10px; background: #d00; color: white; border: none; padding: 5px 10px; cursor: pointer; }
    .highlight { background-color: #c2f0c2; padding: 4px; border-radius: 4px; margin: 2px; display: inline-block; }
    button { background-color: #e10600; color: white; padding: 10px; border: none; margin-top: 10px; cursor: pointer; }
    .gericht-block, .beilage-block { background: #fff; padding: 10px; margin-top: 10px; border: 1px solid #ddd; border-radius: 6px; position: relative; }
    @media print {
      button, .loeschen-btn { display: none !important; }
      body { background: white; }
    }
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo">
  <h1>Partyservice Kleinfeldt – Auftragsplaner</h1>
</header>

<form id="auftragForm">
  <label>Kundenname: <input type="text" id="kunde" required></label><br>
  <label>Lieferdatum: <input type="date" id="datum" required></label><br>
  <label>Personen gesamt: <input type="number" id="personen" required></label><br>
  <div id="gerichteContainer"></div>
  <button type="button" onclick="addGericht()">+ Speise / Beilage hinzufügen</button><br>
  <label>Lieferort: <input type="text" id="ort"></label><br>
  <label>Uhrzeit: <input type="time" id="zeit"></label><br>
  <label>Telefonnummer: <input type="tel" id="telefon"></label><br>
  <label>Notizen:<br><textarea id="notizen" rows="2" cols="30"></textarea></label><br>
  <button type="submit">Auftrag speichern</button>
</form>

<button onclick="window.print()">Alle Aufträge drucken</button>
<div id="auftragListe"></div>

<script>
const beilagenMap = new Map();
const speisenMap = new Map();
const beilageFarben = new Map();
const farben = ["#ffcccc", "#ccffcc", "#ccccff", "#ffffcc", "#ffccff", "#ccffff", "#e6e6fa", "#ffe4e1", "#f0e68c", "#e0ffff"];
let farbIndex = 0;

function formatDatumEU(datumStr) {
  const d = new Date(datumStr);
  return ('0' + d.getDate()).slice(-2) + '.' + ('0' + (d.getMonth() + 1)).slice(-2) + '.' + d.getFullYear();
}

function addGericht() {
  const div = document.createElement("div");
  div.className = "gericht-block";
  const optionen = [
    "Spanferkel", "BBQ Spanferkel", "Honigschinken", "Grillschinken", "Glasierte Pute", "Rinderbraten",
    "Kräuterbraten", "Gyrosbraten", "Griechischer Rahmbraten", "Spießbraten", "Altdeutscher Bierbraten",
    "Schweinefilet in Sahnesauce", "Kassler im Blätterteig", "Bayrischer Leberkäse", "Grünkohl",
    "Wildschweinbraten", "Amerikanische Knabbereien", "Pulled Pork"
  ];
  const options = optionen.map(s => `<option>${s}</option>`).join("");

  div.innerHTML = `
    <label>Speise: <select>${options}</select></label><br>
    <label>Personenanzahl: <input type="number" value="1"></label><br>
    <div class="beilagen"></div>
    <button type="button" onclick="addBeilage(this)">+ Beilage hinzufügen</button>
    <button type="button" class="loeschen-btn" onclick="this.parentElement.remove()">X</button>
  `;
  document.getElementById("gerichteContainer").appendChild(div);
}

function addBeilage(button) {
  const container = button.parentElement.querySelector(".beilagen");
  const div = document.createElement("div");
  div.className = "beilage-block";

  const kartoffeln = ["Kartoffelgratin", "Röstkartoffeln", "Kartoffelspalten", "Kartoffelpüree", "Bratkartoffeln", "Salzkartoffeln", "Reis"];
  const gemuese = ["Bunte Gemüseauswahl", "Rotkohl", "Rosenkohl", "Geschmortes Kraut"];
  const salate = ["Weißkrautsalat Natur", "Weißkrautsalat mit Yogurt", "Frischer gemischter Salat", "Eisberg-Melonen Salat",
                  "Griechischer Salat", "Kartoffelsalat", "Speckkartoffelsalat", "Nudelsalat", "Coleslaw"];

  let options = '<optgroup label="Kartoffelbeilagen">';
  options += kartoffeln.map(b => `<option>${b}</option>`).join("");
  options += '</optgroup><optgroup label="Gemüse">';
  options += gemuese.map(b => `<option>${b}</option>`).join("");
  options += '</optgroup><optgroup label="Salate">';
  options += salate.map(b => `<option>${b}</option>`).join("");
  options += '</optgroup>';

  div.innerHTML = `
    <label>Beilage: <select>${options}</select></label>
    <label>für <input type="number" value="1"> Personen</label>
    <button type="button" class="loeschen-btn" onclick="this.parentElement.remove()">X</button>
  `;
  container.appendChild(div);
}

document.getElementById("auftragForm").addEventListener("submit", function(e) {
  e.preventDefault();
  beilagenMap.clear();
  speisenMap.clear();
  beilageFarben.clear();
  farbIndex = 0;

  const kunde = document.getElementById("kunde").value;
  const datum = document.getElementById("datum").value;
  const personen = parseInt(document.getElementById("personen").value);
  const ort = document.getElementById("ort").value;
  const zeit = document.getElementById("zeit").value;
  const telefon = document.getElementById("telefon").value;
  const notizen = document.getElementById("notizen").value;

  let speisenOutput = "";
  const gerichte = document.querySelectorAll(".gericht-block");
  gerichte.forEach((gericht, index) => {
    const speise = gericht.querySelector("select").value;
    const pers = parseInt(gericht.querySelector("input").value);
    speisenOutput += `<p><strong>Speise ${index + 1}:</strong> ${speise} für ${pers} Personen</p>`;
    if (!speisenMap.has(speise)) speisenMap.set(speise, 0);
    speisenMap.set(speise, speisenMap.get(speise) + pers);

    const beilagen = gericht.querySelectorAll(".beilage-block");
    if (beilagen.length > 0) {
      speisenOutput += "<p>Beilagen:<br>";
      beilagen.forEach(beilage => {
        const b = beilage.querySelector("select").value;
        const p = parseInt(beilage.querySelector("input").value);
        const key = b.toLowerCase();
        if (!beilagenMap.has(key)) beilagenMap.set(key, 0);
        beilagenMap.set(key, beilagenMap.get(key) + p);
        speisenOutput += `<span class="highlight" style="background-color:${getBeilageFarbe(key)}">${b}: ${p} Personen</span> `;
      });
      speisenOutput += "</p>";
    }
  });

  let mengenOutput = "<p><strong>Gesamtmengen:</strong><br>";
  speisenMap.forEach((menge, name) => {
    let grammProPerson = name.toLowerCase().includes("spanferkel") ? 650 : 250;
    mengenOutput += `<span class="highlight">${name}: ${(menge * grammProPerson / 1000).toFixed(2)} kg Fleisch</span> `;
  });
  beilagenMap.forEach((menge, name) => {
    let grammProPerson = name.includes("geschmortes kraut") ? 150 : 250;
    mengenOutput += `<span class="highlight" style="background-color:${getBeilageFarbe(name)}">${name}: ${(menge * grammProPerson / 1000).toFixed(2)} kg</span> `;
  });
  mengenOutput += "</p>";

  const auftragDiv = document.createElement("div");
  auftragDiv.className = "auftrag";
  auftragDiv.innerHTML = `
    <button class="loeschen-btn" onclick="this.parentElement.remove()">X</button>
    <h3>Kunde: ${kunde}</h3>
    <p><strong>Datum:</strong> ${formatDatumEU(datum)} | <strong>Gesamtpersonen:</strong> ${personen}</p>
    <p><strong>Ort:</strong> ${ort} | <strong>Zeit:</strong> ${zeit}</p>
    <p><strong>Telefon:</strong> ${telefon}</p>
    <p><strong>Notizen:</strong> ${notizen}</p>
    ${speisenOutput}
    ${mengenOutput}
  `;

  document.getElementById("auftragListe").appendChild(auftragDiv);
  this.reset();
  document.getElementById("gerichteContainer").innerHTML = '';
});

function getBeilageFarbe(name) {
  if (!beilageFarben.has(name)) {
    beilageFarben.set(name, farben[farbIndex % farben.length]);
    farbIndex++;
  }
  return beilageFarben.get(name);
}
</script>
</body>
</html>
